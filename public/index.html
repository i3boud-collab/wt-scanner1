<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#03060f">
<title>WT Scanner</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&family=Oxanium:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOKENS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root{
  --bg:       #03060f;
  --s1:       #070e1d;
  --s2:       #0b1730;
  --s3:       #112040;
  --s4:       #1a3060;
  --border:   rgba(255,255,255,.055);
  --border2:  rgba(255,255,255,.1);
  --buy:      #00f5aa;
  --buy2:     rgba(0,245,170,.12);
  --buy3:     rgba(0,245,170,.06);
  --sell:     #ff2d55;
  --sell2:    rgba(255,45,85,.12);
  --sell3:    rgba(255,45,85,.06);
  --blue:     #38bdf8;
  --gold:     #fbbf24;
  --purple:   #a78bfa;
  --txt:      #dde4f0;
  --muted:    #4a5a7a;
  --muted2:   #2a3a5a;
  --mono:     'Oxanium', monospace;
  --sans:     'Tajawal', sans-serif;
  --r:        14px;
  --sat: env(safe-area-inset-top,0px);
  --sab: env(safe-area-inset-bottom,0px);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET & BASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html{font-size:16px;overflow-x:hidden}
body{
  background:var(--bg);color:var(--txt);
  font-family:var(--sans);min-height:100vh;
  background-image:
    radial-gradient(ellipse 80% 40% at 50% -10%, rgba(56,189,248,.07) 0%, transparent 70%),
    radial-gradient(ellipse 60% 30% at 80% 110%, rgba(0,245,170,.05) 0%, transparent 70%);
  background-attachment:fixed;
}

/* subtle grid */
body::before{
  content:'';position:fixed;inset:0;
  background-image:
    linear-gradient(rgba(56,189,248,.018) 1px,transparent 1px),
    linear-gradient(90deg,rgba(56,189,248,.018) 1px,transparent 1px);
  background-size:48px 48px;
  pointer-events:none;z-index:0;
}

/* scan line flicker */
@keyframes scanline{
  0%{transform:translateY(-100%)}
  100%{transform:translateY(100vh)}
}
body::after{
  content:'';position:fixed;left:0;right:0;
  height:2px;
  background:linear-gradient(transparent,rgba(0,245,170,.04),transparent);
  animation:scanline 8s linear infinite;
  pointer-events:none;z-index:1;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
header{
  position:sticky;top:0;z-index:200;
  padding:calc(10px + var(--sat)) 16px 10px;
  background:rgba(3,6,15,.88);
  backdrop-filter:blur(30px) saturate(180%);
  border-bottom:1px solid var(--border2);
}
.hd{display:flex;align-items:center;justify-content:space-between;gap:8px}

.logo{display:flex;align-items:center;gap:11px}
.logo-ring{
  width:40px;height:40px;flex-shrink:0;
  border-radius:12px;
  background:conic-gradient(from 0deg, var(--buy),var(--blue),var(--purple),var(--buy));
  display:flex;align-items:center;justify-content:center;
  animation:hue 10s linear infinite;
  font-size:20px;
  box-shadow:0 0 18px rgba(0,245,170,.2);
}
@keyframes hue{to{filter:hue-rotate(360deg)}}
.logo-text{font-family:var(--mono);font-size:18px;font-weight:800;letter-spacing:.5px;color:#fff}
.logo-sub{font-size:9px;color:var(--muted);letter-spacing:1.5px;text-transform:uppercase;margin-top:1px}

.hd-right{display:flex;align-items:center;gap:8px}

.live-chip{
  display:flex;align-items:center;gap:5px;
  padding:5px 11px;border-radius:20px;
  background:rgba(0,245,170,.06);
  border:1px solid rgba(0,245,170,.18);
  font-family:var(--mono);font-size:10px;color:var(--buy);
}
.live-dot{width:5px;height:5px;border-radius:50%;background:var(--buy);animation:pulse 1.6s ease infinite}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.3;transform:scale(.7)}}

.market-state{
  font-family:var(--mono);font-size:10px;
  padding:4px 9px;border-radius:6px;
  background:var(--s2);border:1px solid var(--border);
  color:var(--muted);
}
.market-state.open{color:#4ade80;border-color:rgba(74,222,128,.2);background:rgba(74,222,128,.06)}
.market-state.closed{color:var(--sell);border-color:rgba(255,45,85,.2);background:rgba(255,45,85,.06)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INFO BAR (update + countdown)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.info-bar{
  background:rgba(7,14,29,.9);
  border-bottom:1px solid var(--border);
  padding:7px 16px;
  display:flex;align-items:center;justify-content:space-between;
  font-size:11px;color:var(--muted);gap:8px;
  font-family:var(--mono);
}
.ib-left{display:flex;align-items:center;gap:8px;min-width:0}
.ib-dot{width:4px;height:4px;border-radius:50%;background:var(--muted);flex-shrink:0}
.ib-update{color:var(--txt);font-size:11px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

.cd-pill{
  display:flex;align-items:center;gap:5px;
  background:var(--s2);border:1px solid var(--border);
  border-radius:6px;padding:3px 9px;flex-shrink:0;
  transition:all .3s;
}
.cd-pill.soon{background:rgba(251,191,36,.08);border-color:rgba(251,191,36,.2)}
.cd-label{font-size:9px;color:var(--muted)}
.cd-val{font-size:13px;font-weight:700;color:var(--blue);min-width:36px;text-align:center}
.cd-pill.soon .cd-val{color:var(--gold)}

.scanning-wrap{display:none;align-items:center;gap:6px;color:var(--gold);font-size:11px}
.scanning-wrap.active{display:flex}
.spin{display:inline-block;animation:rot .7s linear infinite}
@keyframes rot{to{transform:rotate(360deg)}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATS ROW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.stats-row{
  display:grid;grid-template-columns:repeat(4,1fr);
  background:var(--s1);
  border-bottom:1px solid var(--border);
  position:relative;z-index:1;
}
.s-card{
  padding:13px 8px;text-align:center;
  border-left:1px solid var(--border);
  position:relative;overflow:hidden;
}
.s-card:last-child{border-left:none}
.s-card::after{
  content:'';position:absolute;
  bottom:0;left:15%;right:15%;height:1.5px;
  border-radius:1px;
}
.s-card.g::after{background:linear-gradient(90deg,transparent,var(--buy),transparent)}
.s-card.r::after{background:linear-gradient(90deg,transparent,var(--sell),transparent)}
.s-card.b::after{background:linear-gradient(90deg,transparent,var(--blue),transparent)}
.s-card.y::after{background:linear-gradient(90deg,transparent,var(--gold),transparent)}

.s-n{font-family:var(--mono);font-size:24px;font-weight:800;line-height:1;
  background:var(--bg);/* override per card */
  -webkit-background-clip:text;background-clip:text;
}
.s-card.g .s-n{color:var(--buy)}
.s-card.r .s-n{color:var(--sell)}
.s-card.b .s-n{color:var(--blue)}
.s-card.y .s-n{color:var(--gold)}
.s-lbl{font-size:8.5px;color:var(--muted);margin-top:3px;letter-spacing:.5px;text-transform:uppercase}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FILTERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.filters{
  display:flex;gap:6px;overflow-x:auto;
  padding:10px 14px;
  background:var(--s1);
  border-bottom:1px solid var(--border);
  scrollbar-width:none;position:relative;z-index:1;
}
.filters::-webkit-scrollbar{display:none}

.f{
  flex-shrink:0;
  font-family:var(--sans);font-size:12px;font-weight:500;
  padding:6px 14px;border-radius:9px;cursor:pointer;
  background:var(--s2);border:1px solid var(--border2);
  color:var(--muted);transition:all .18s;white-space:nowrap;
}
.f:hover{color:var(--txt);border-color:var(--border2)}
.f.on{background:var(--s3);color:var(--txt);border-color:var(--blue);
  box-shadow:0 0 12px rgba(56,189,248,.1)}
.f.on-buy{background:var(--buy3);color:var(--buy);border-color:rgba(0,245,170,.3);
  box-shadow:0 0 12px rgba(0,245,170,.1)}
.f.on-sell{background:var(--sell3);color:var(--sell);border-color:rgba(255,45,85,.3);
  box-shadow:0 0 12px rgba(255,45,85,.1)}
.f-cnt{
  display:inline-flex;align-items:center;justify-content:center;
  background:var(--s4);border-radius:5px;
  font-family:var(--mono);font-size:9px;font-weight:700;
  padding:0 5px;min-width:18px;height:16px;margin-right:5px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARDS GRID
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.cards{
  padding:12px 12px calc(76px + var(--sab));
  display:flex;flex-direction:column;gap:9px;
  position:relative;z-index:1;
}
@media(min-width:580px){.cards{display:grid;grid-template-columns:repeat(2,1fr)}}
@media(min-width:960px){.cards{grid-template-columns:repeat(3,1fr)}}

/* â”€â”€â”€â”€â”€â”€ SIGNAL CARD â”€â”€â”€â”€â”€â”€ */
.card{
  border-radius:var(--r);
  border:1px solid var(--border);
  background:var(--s1);
  overflow:hidden;
  transition:transform .12s,box-shadow .2s;
  animation:rise .3s ease both;
}
@keyframes rise{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.card:active{transform:scale(.97)}

.card.buy{
  border-top:2px solid var(--buy);
  box-shadow:0 2px 20px rgba(0,245,170,.05);
}
.card.sell{
  border-top:2px solid var(--sell);
  box-shadow:0 2px 20px rgba(255,45,85,.05);
}
.card.buy:hover{box-shadow:0 4px 30px rgba(0,245,170,.1)}
.card.sell:hover{box-shadow:0 4px 30px rgba(255,45,85,.1)}

/* card header */
.ch{
  display:flex;align-items:flex-start;
  justify-content:space-between;gap:10px;
  padding:13px 14px 10px;
}
.ch-left{display:flex;align-items:center;gap:10px}
.arrow-box{
  width:40px;height:40px;border-radius:11px;
  display:flex;align-items:center;justify-content:center;
  font-size:22px;font-family:var(--mono);font-weight:800;
  flex-shrink:0;
}
.card.buy  .arrow-box{background:rgba(0,245,170,.1);color:var(--buy)}
.card.sell .arrow-box{background:rgba(255,45,85,.1);color:var(--sell)}

.ch-info{}
.sym-row{display:flex;align-items:center;gap:7px}
.sym{
  font-family:var(--mono);font-size:19px;font-weight:800;letter-spacing:.5px;
}
.card.buy  .sym{color:var(--buy)}
.card.sell .sym{color:var(--sell)}

.new-tag{
  background:var(--sell);color:#fff;
  font-size:7px;font-family:var(--mono);font-weight:800;
  padding:2px 5px;border-radius:4px;letter-spacing:.8px;
  animation:pulse 1s infinite;
}
.ch-date{font-size:10px;color:var(--muted);font-family:var(--mono);margin-top:2px}

.ch-right{text-align:left;flex-shrink:0}
.ch-price{
  font-family:var(--mono);font-size:21px;font-weight:800;color:var(--txt);
  line-height:1;
}
.ch-price-lbl{font-size:8px;color:var(--muted);text-align:center;margin-top:2px;letter-spacing:.5px}

/* pill row */
.pills{
  display:flex;flex-wrap:wrap;gap:5px;
  padding:0 14px 12px;
}
.p{
  display:inline-flex;align-items:center;gap:3px;
  padding:3px 9px;border-radius:7px;
  font-size:10px;font-family:var(--mono);font-weight:700;letter-spacing:.3px;
  border:1px solid;
}
.p-sig-buy {background:rgba(0,245,170,.1);color:var(--buy);border-color:rgba(0,245,170,.25)}
.p-sig-sell{background:rgba(255,45,85,.1);color:var(--sell);border-color:rgba(255,45,85,.25)}
.p-green   {background:rgba(74,222,128,.08);color:#4ade80;border-color:rgba(74,222,128,.2)}
.p-gray    {background:rgba(255,255,255,.03);color:var(--muted);border-color:var(--border)}
.p-gold    {background:rgba(251,191,36,.08);color:var(--gold);border-color:rgba(251,191,36,.2)}
.p-blue    {background:rgba(56,189,248,.08);color:var(--blue);border-color:rgba(56,189,248,.2)}
.p-purple  {background:rgba(167,139,250,.08);color:var(--purple);border-color:rgba(167,139,250,.2)}

/* RSI inside pill */
.rsi-mini{display:flex;align-items:center;gap:5px}
.rsi-track{width:40px;height:3px;background:var(--s3);border-radius:2px;overflow:hidden}
.rsi-fill{height:100%;border-radius:2px;transition:width .4s}

/* card footer */
.cf{
  display:flex;gap:0;
  border-top:1px solid var(--border);
}
.cf-item{
  flex:1;
  padding:9px 8px;
  text-align:center;
  border-left:1px solid var(--border);
}
.cf-item:last-child{border-left:none}
.cf-val{font-family:var(--mono);font-size:12px;font-weight:700}
.cf-lbl{font-size:8px;color:var(--muted);margin-top:2px;text-transform:uppercase;letter-spacing:.4px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EMPTY / LOADING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.empty{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  padding:80px 20px;gap:14px;color:var(--muted);text-align:center;
}
.e-icon{font-size:52px;opacity:.25;animation:float 3s ease-in-out infinite}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
.e-title{font-size:17px;font-weight:700;color:var(--txt)}
.e-sub{font-size:12px;line-height:1.7;max-width:260px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOTTOM BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bot{
  position:fixed;bottom:0;left:0;right:0;z-index:200;
  padding:8px 14px calc(8px + var(--sab));
  background:rgba(3,6,15,.93);
  backdrop-filter:blur(30px);
  border-top:1px solid var(--border2);
  display:flex;align-items:center;gap:8px;
}
.search{
  flex:1;
  background:var(--s2);
  border:1px solid var(--border2);
  border-radius:11px;
  padding:10px 14px;
  color:var(--txt);
  font-family:var(--mono);font-size:13px;
  outline:none;direction:ltr;
  transition:border-color .2s;
}
.search:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(56,189,248,.08)}
.search::placeholder{color:var(--muted);font-size:11px}

.icon-btn{
  width:42px;height:42px;flex-shrink:0;
  border-radius:11px;
  background:var(--s2);border:1px solid var(--border2);
  display:flex;align-items:center;justify-content:center;
  font-size:16px;cursor:pointer;
  transition:all .15s;
}
.icon-btn:active{transform:scale(.9);background:var(--s3)}
.icon-btn.spinning{animation:rot .6s linear infinite}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NOTIFICATION TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.toast{
  position:fixed;top:calc(70px + var(--sat));left:50%;
  transform:translateX(-50%) translateY(-20px);
  background:var(--s2);
  border:1px solid var(--border2);
  border-radius:12px;padding:11px 20px;
  font-size:12px;color:var(--txt);
  box-shadow:0 8px 30px rgba(0,0,0,.4);
  opacity:0;transition:all .3s;z-index:300;
  white-space:nowrap;pointer-events:none;
  max-width:90vw;overflow:hidden;text-overflow:ellipsis;
}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* notif banner */
.n-banner{
  margin:8px 12px 0;
  padding:10px 14px;
  background:rgba(0,245,170,.05);
  border:1px solid rgba(0,245,170,.14);
  border-radius:12px;
  font-size:12px;
  display:none;align-items:center;gap:8px;
  position:relative;z-index:1;
}
.n-banner.show{display:flex}
.n-banner-close{margin-right:auto;cursor:pointer;opacity:.4;font-size:13px;padding:2px 4px}
.n-btn{
  flex-shrink:0;background:var(--buy);color:#000;
  border:none;border-radius:7px;padding:5px 12px;
  font-family:var(--sans);font-size:11px;font-weight:700;cursor:pointer;
}
</style>
</head>
<body>

<!-- HEADER -->
<header>
  <div class="hd">
    <div class="logo">
      <div class="logo-ring">ğŸ“¡</div>
      <div>
        <div class="logo-text">WT SCANNER</div>
        <div class="logo-sub">WaveTrend Â· RSI Â· Volume</div>
      </div>
    </div>
    <div class="hd-right">
      <div class="market-state" id="mktState">â€”</div>
      <div class="live-chip"><div class="live-dot"></div>LIVE</div>
    </div>
  </div>
</header>

<!-- NOTIFICATION BANNER -->
<div class="n-banner" id="nBanner">
  <span>ğŸ””</span>
  <span>ÙØ¹Ù‘Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„ØªØµÙ„Ùƒ Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙˆØ±Ø§Ù‹</span>
  <span class="n-banner-close" onclick="dismissBanner()">âœ•</span>
  <button class="n-btn" onclick="askNotif()">ØªÙØ¹ÙŠÙ„</button>
</div>

<!-- INFO BAR -->
<div class="info-bar">
  <div class="ib-left">
    <div class="ib-dot"></div>
    <span>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</span>
    <span class="ib-update" id="ibUpdate">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</span>
  </div>

  <div class="scanning-wrap" id="scanWrap">
    <span class="spin">âŸ³</span><span>ÙŠØ¬Ø±ÙŠ Ø§Ù„Ù…Ø³Ø­</span>
  </div>

  <div class="cd-pill" id="cdPill">
    <span class="cd-label">Ø§Ù„ØªØ§Ù„ÙŠ</span>
    <span class="cd-val" id="cdVal">â€”</span>
  </div>
</div>

<!-- STATS -->
<div class="stats-row">
  <div class="s-card g">
    <div class="s-n" id="stBuy">0</div>
    <div class="s-lbl">Ø´Ø±Ø§Ø¡</div>
  </div>
  <div class="s-card r">
    <div class="s-n" id="stSell">0</div>
    <div class="s-lbl">Ø¨ÙŠØ¹</div>
  </div>
  <div class="s-card y">
    <div class="s-n" id="stVol">0</div>
    <div class="s-lbl">ÙÙˆÙ„ÙŠÙˆÙ…âœ“</div>
  </div>
  <div class="s-card b">
    <div class="s-n" id="stSym">0</div>
    <div class="s-lbl">Ø±Ù…ÙˆØ²</div>
  </div>
</div>

<!-- FILTERS -->
<div class="filters" id="filters">
  <button class="f on"       onclick="setF(this,'all')">  Ø§Ù„ÙƒÙ„</button>
  <button class="f"          onclick="setF(this,'buy')">  <span class="f-cnt" id="fcBuy"  style="color:var(--buy)">0</span>ğŸ“ˆ Ø´Ø±Ø§Ø¡</button>
  <button class="f"          onclick="setF(this,'sell')"> <span class="f-cnt" id="fcSell" style="color:var(--sell)">0</span>ğŸ“‰ Ø¨ÙŠØ¹</button>
  <button class="f"          onclick="setF(this,'vol')">  âš¡ ÙÙˆÙ„ÙŠÙˆÙ… Ù…Ø¤ÙƒØ¯</button>
  <button class="f"          onclick="setF(this,'rsi')">  RSI Ù…Ø¤ÙƒØ¯</button>
  <button class="f"          onclick="setF(this,'strong')">ğŸ”¥ Ø¥Ø´Ø§Ø±Ø§Øª Ù‚ÙˆÙŠØ©</button>
</div>

<!-- CARDS -->
<div class="cards" id="cards">
  <div class="empty">
    <div class="e-icon">ğŸ›°ï¸</div>
    <div class="e-title">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</div>
    <div class="e-sub">ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¢Ø®Ø± Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±</div>
  </div>
</div>

<!-- BOTTOM BAR -->
<div class="bot">
  <input class="search" id="srch" placeholder="Ø§Ø¨Ø­Ø«... AAPL, NVDA"
         oninput="onSrch(this.value)"
         autocomplete="off" autocapitalize="characters" autocorrect="off">
  <div class="icon-btn" id="rfBtn" onclick="manualRefresh()" title="ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¢Ù†">âŸ³</div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let allSig = [], filter = 'all', srch = '', lastCnt = 0;
let nextAt = 0, cdTmr = null;
const REFRESH = 5 * 60 * 1000;  // 5 Ø¯Ù‚Ø§Ø¦Ù‚

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FETCH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function fetchData() {
  try {
    const res = await fetch('/api/signals', { cache: 'no-store' });
    if (!res.ok) throw new Error('HTTP ' + res.status);
    const d = await res.json();

    const scanning = d.status === 'initializing' || false;
    document.getElementById('scanWrap').classList.toggle('active', scanning);

    if (d.updatedAt) {
      const dt = new Date(d.updatedAt);
      document.getElementById('ibUpdate').textContent =
        dt.toLocaleTimeString('ar-SA', { hour:'2-digit', minute:'2-digit' });
    } else {
      document.getElementById('ibUpdate').textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯';
    }

    const sigs = d.signals || [];

    // Notify if new signals
    if (lastCnt > 0 && sigs.length > lastCnt) {
      const n = sigs.length - lastCnt;
      pushNotif(`ğŸ“¡ ${n} Ø¥Ø´Ø§Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø¸Ù‡Ø±Øª!`);
      toast(`ğŸ”” ${n} Ø¥Ø´Ø§Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©`);
    }
    lastCnt = sigs.length;
    allSig  = sigs;

    renderStats();
    renderCards();
    setNextAt(Date.now() + REFRESH);

  } catch(e) {
    document.getElementById('ibUpdate').textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„';
    document.getElementById('cards').innerHTML = `
      <div class="empty">
        <div class="e-icon">âš ï¸</div>
        <div class="e-title">ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ø§ØªØµØ§Ù„</div>
        <div class="e-sub">ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± ÙŠØ¹Ù…Ù„<br>Ø£Ùˆ Ø§Ù†ØªØ¸Ø± Ù„Ø­Ø¸Ø© Ø«Ù… Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹</div>
      </div>`;
  }
}

function manualRefresh() {
  const b = document.getElementById('rfBtn');
  b.classList.add('spinning');
  fetchData().finally(() => b.classList.remove('spinning'));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MARKET STATE (Ø¨ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠ)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateMarket() {
  const el  = document.getElementById('mktState');
  const now = new Date();
  const ny  = new Date(now.toLocaleString('en-US', { timeZone: 'America/New_York' }));
  const h   = ny.getHours(), m = ny.getMinutes(), day = ny.getDay();
  const mins = h * 60 + m;
  const isWeekday = day >= 1 && day <= 5;
  const isOpen    = isWeekday && mins >= 9 * 60 + 30 && mins < 16 * 60;
  const isPre     = isWeekday && mins >= 4 * 60 && mins < 9 * 60 + 30;

  if (isOpen)       { el.textContent = 'â— OPEN';   el.className = 'market-state open';   }
  else if (isPre)   { el.textContent = 'â—‘ PRE';    el.className = 'market-state';        }
  else              { el.textContent = 'â—‹ CLOSED'; el.className = 'market-state closed'; }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COUNTDOWN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setNextAt(ts) {
  nextAt = ts;
  if (cdTmr) clearInterval(cdTmr);
  cdTmr = setInterval(() => {
    const left = nextAt - Date.now();
    if (left <= 0) { clearInterval(cdTmr); fetchData(); return; }
    const m = Math.floor(left / 60000);
    const s = Math.floor((left % 60000) / 1000);
    const el = document.getElementById('cdVal');
    el.textContent = `${m}:${String(s).padStart(2,'0')}`;
    const pill = document.getElementById('cdPill');
    pill.classList.toggle('soon', left < 60000);
  }, 1000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderStats() {
  const buy  = allSig.filter(s => s.type === 'buy').length;
  const sell = allSig.filter(s => s.type === 'sell').length;
  const vol  = allSig.filter(s => s.volConf).length;
  const syms = new Set(allSig.map(s => s.symbol)).size;
  anim('stBuy', buy); anim('stSell', sell);
  anim('stVol', vol); anim('stSym', syms);
  document.getElementById('fcBuy').textContent  = buy;
  document.getElementById('fcSell').textContent = sell;
}

function anim(id, target) {
  const el = document.getElementById(id);
  let cur = parseInt(el.textContent) || 0;
  if (cur === target) return;
  const step = target > cur ? 1 : -1;
  const t = setInterval(() => {
    cur += step;
    el.textContent = cur;
    if (cur === target) clearInterval(t);
  }, 40);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILTER & RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setF(btn, f) {
  filter = f;
  document.querySelectorAll('.f').forEach(b =>
    b.classList.remove('on','on-buy','on-sell'));
  btn.classList.add('on');
  if (f === 'buy')  btn.classList.add('on-buy');
  if (f === 'sell') btn.classList.add('on-sell');
  renderCards();
}

function onSrch(v) { srch = v.trim(); renderCards(); }

function getFiltered() {
  let d = [...allSig];
  if (filter === 'buy')    d = d.filter(s => s.type === 'buy');
  if (filter === 'sell')   d = d.filter(s => s.type === 'sell');
  if (filter === 'vol')    d = d.filter(s => s.volConf);
  if (filter === 'rsi')    d = d.filter(s => s.rsiSignal);
  if (filter === 'strong') d = d.filter(s => s.volConf && s.rsiSignal);
  if (srch) {
    const q = srch.toUpperCase();
    d = d.filter(s => s.symbol.includes(q));
  }
  return d;
}

function fmtVol(v) {
  if (!v) return 'â€”';
  if (v >= 1e6) return (v / 1e6).toFixed(1) + 'M';
  if (v >= 1e3) return (v / 1e3).toFixed(0) + 'K';
  return v;
}

function renderCards() {
  const data = getFiltered();
  const wrap = document.getElementById('cards');
  const now  = Date.now() / 1000;

  if (!data.length) {
    wrap.innerHTML = `
      <div class="empty">
        <div class="e-icon">${allSig.length ? 'ğŸ”' : 'ğŸ›°ï¸'}</div>
        <div class="e-title">${allSig.length ? 'Ù„Ø§ Ù†ØªØ§Ø¦Ø¬ Ø¨Ù‡Ø°Ø§ Ø§Ù„ÙÙ„ØªØ±' : 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø§Ø±Ø§Øª'}</div>
        <div class="e-sub">${allSig.length ? 'Ø¬Ø±Ù‘Ø¨ ÙÙ„ØªØ±Ø§Ù‹ Ø¢Ø®Ø± Ø£Ùˆ Ø§Ø¨Ø­Ø« Ø¨Ø±Ù…Ø² Ù…Ø®ØªÙ„Ù' : 'Ù„Ù… ØªÙÙƒØªØ´Ù Ø¥Ø´Ø§Ø±Ø§Øª ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©\nØ³ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø®Ù„Ø§Ù„ 5 Ø¯Ù‚Ø§Ø¦Ù‚'}</div>
      </div>`;
    return;
  }

  let html = '';
  data.forEach((s, i) => {
    const buy    = s.type === 'buy';
    const isNew  = i < 5 && (now - (s.timestamp / 1000)) < 3600;
    const rsiC   = s.rsi === null ? 'var(--muted)'
                 : s.rsi < 30 ? 'var(--buy)'
                 : s.rsi > 70 ? 'var(--sell)'
                 : 'var(--blue)';
    const rsiP   = s.rsi !== null ? Math.min(100, s.rsi) : 0;

    html += `
    <div class="card ${s.type}" style="animation-delay:${Math.min(i*25,300)}ms">
      <div class="ch">
        <div class="ch-left">
          <div class="arrow-box">${buy ? 'â–²' : 'â–¼'}</div>
          <div>
            <div class="sym-row">
              <span class="sym">${s.symbol}</span>
              ${isNew ? '<span class="new-tag">NEW</span>' : ''}
            </div>
            <div class="ch-date">â± ${s.date}</div>
          </div>
        </div>
        <div class="ch-right">
          <div class="ch-price">$${s.close.toFixed(2)}</div>
          <div class="ch-price-lbl">CLOSE</div>
        </div>
      </div>

      <div class="pills">
        <span class="p ${buy ? 'p-sig-buy' : 'p-sig-sell'}">${buy ? 'â–² BUY' : 'â–¼ SELL'}</span>
        ${s.volConf  ? '<span class="p p-green">âš¡ VOL âœ“</span>'   : '<span class="p p-gray">VOL âœ—</span>'}
        ${s.highVol  ? '<span class="p p-gold">ğŸ”¥ HIGH VOL</span>' : ''}
        ${s.rsiSignal? '<span class="p p-purple">RSI âœ“</span>'     : ''}
        ${s.rsi !== null ? `
        <span class="p p-gray">
          <span class="rsi-mini">
            <span style="color:${rsiC};min-width:28px">RSI ${s.rsi}</span>
            <span class="rsi-track">
              <span class="rsi-fill" style="width:${rsiP}%;background:${rsiC}"></span>
            </span>
          </span>
        </span>` : ''}
      </div>

      <div class="cf">
        <div class="cf-item">
          <div class="cf-val" style="color:var(--blue)">${fmtVol(s.volume)}</div>
          <div class="cf-lbl">ÙÙˆÙ„ÙŠÙˆÙ…</div>
        </div>
        <div class="cf-item">
          <div class="cf-val" style="color:var(--muted)">${fmtVol(s.avgVol)}</div>
          <div class="cf-lbl">Ù…ØªÙˆØ³Ø· 5</div>
        </div>
        <div class="cf-item">
          <div class="cf-val" style="color:${s.highVol ? 'var(--gold)' : 'var(--muted)'}">
            ${s.highVol ? 'Ø¹Ø§Ù„Ùâœ“' : 'Ø¹Ø§Ø¯ÙŠ'}
          </div>
          <div class="cf-lbl">Ø­Ø¬Ù…</div>
        </div>
      </div>
    </div>`;
  });

  wrap.innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NOTIFICATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function dismissBanner() {
  document.getElementById('nBanner').classList.remove('show');
  localStorage.setItem('nb','1');
}
function askNotif() {
  if (!('Notification' in window)) return;
  Notification.requestPermission().then(p => {
    if (p === 'granted') { dismissBanner(); toast('âœ… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…ÙØ¹Ù‘Ù„Ø©'); }
  });
}
function pushNotif(msg) {
  if (typeof Notification !== 'undefined' && Notification.permission === 'granted')
    new Notification('WT Scanner', { body: msg });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let toastTmr;
function toast(msg) {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.classList.add('show');
  clearTimeout(toastTmr);
  toastTmr = setTimeout(() => el.classList.remove('show'), 3200);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.addEventListener('DOMContentLoaded', () => {
  updateMarket();
  setInterval(updateMarket, 30000);

  // Show notif banner
  if (!localStorage.getItem('nb') && 'Notification' in window
      && Notification.permission === 'default')
    setTimeout(() => document.getElementById('nBanner').classList.add('show'), 2500);

  // First load
  fetchData();
  setInterval(fetchData, REFRESH);

  // Refresh when tab regains focus
  document.addEventListener('visibilitychange', () => {
    if (!document.hidden && Date.now() > nextAt - 5000) fetchData();
  });
});
</script>
</body>
</html>
